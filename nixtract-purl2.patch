From 599e0d7341d28b371347ebc249fc28830e112989 Mon Sep 17 00:00:00 2001
From: Hans Joachim Kliemeck <h0nIg@users.noreply.github.com>
Date: Fri, 5 Sep 2025 13:15:33 +0200
Subject: [PATCH 1/3] API change of CPE's

---
 src/nix/describe_derivation.nix | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/nix/describe_derivation.nix b/src/nix/describe_derivation.nix
index 491e475..973573c 100644
--- a/src/nix/describe_derivation.nix
+++ b/src/nix/describe_derivation.nix
@@ -49,7 +49,8 @@ in
       version = (builtins.tryEval (targetValue.version or "")).value;
       broken = (builtins.tryEval (targetValue.meta.broken or false)).value;
       homepage = (builtins.tryEval (targetValue.meta.homepage or "")).value;
-      cpe = (builtins.tryEval (targetValue.meta.identifiers.v1.cpe or [])).value;
+      cpe = (builtins.tryEval (targetValue.meta.identifiers.v1.cpe or null)).value;
+      possibleCPEs = (builtins.tryEval (targetValue.meta.identifiers.v1.possibleCPEs or [])).value;
       purl = (builtins.tryEval (targetValue.meta.identifiers.v1.purl or null)).value;
       licenses = (builtins.tryEval (
         if builtins.isAttrs (targetValue.meta.license or null)

From a932fb4b46d24e2b12587afa239b629331b4bd8f Mon Sep 17 00:00:00 2001
From: Hans Joachim Kliemeck <h0nIg@users.noreply.github.com>
Date: Fri, 10 Oct 2025 17:24:30 +0200
Subject: [PATCH 2/3] refresh

---
 src/nix/describe_derivation.nix | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/nix/describe_derivation.nix b/src/nix/describe_derivation.nix
index 973573c..d539cea 100644
--- a/src/nix/describe_derivation.nix
+++ b/src/nix/describe_derivation.nix
@@ -52,6 +52,7 @@ in
       cpe = (builtins.tryEval (targetValue.meta.identifiers.v1.cpe or null)).value;
       possibleCPEs = (builtins.tryEval (targetValue.meta.identifiers.v1.possibleCPEs or [])).value;
       purl = (builtins.tryEval (targetValue.meta.identifiers.v1.purl or null)).value;
+      purls = (builtins.tryEval (targetValue.meta.identifiers.v1.purls or [])).value;
       licenses = (builtins.tryEval (
         if builtins.isAttrs (targetValue.meta.license or null)
         # In case the license attribute is not a list, we produce a singleton list to be consistent

From facf87df04ba6ce5f4e1cf7a139547348aa8a9a5 Mon Sep 17 00:00:00 2001
From: Hans Joachim Kliemeck <h0nIg@users.noreply.github.com>
Date: Wed, 15 Oct 2025 08:40:01 +0200
Subject: [PATCH 3/3] added missing code to reflect properties

---
 src/nix/describe_derivation.rs | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/src/nix/describe_derivation.rs b/src/nix/describe_derivation.rs
index 55e4a60..ef2ad81 100644
--- a/src/nix/describe_derivation.rs
+++ b/src/nix/describe_derivation.rs
@@ -43,6 +43,10 @@ pub struct NixpkgsMetadata {
     pub broken: bool,
     pub homepage: String,
     pub licenses: Option<Vec<License>>,
+    pub cpe: Option<String>,
+    pub possibleCPEs: Vec<String>,
+    pub purl: Option<String>,
+    pub purls: Vec<String>,
 }

 #[derive(Deserialize, Serialize, Debug, Eq, PartialEq, Clone, JsonSchema)]
